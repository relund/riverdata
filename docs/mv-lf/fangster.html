
<!DOCTYPE html>
<html lang="en">
	<head>
		<link href="https://unpkg.com/tabulator-tables/dist/css/tabulator.min.css" rel="stylesheet">
		<script type="text/javascript" src="https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/luxon/build/global/luxon.min.js"></script>
		<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/kitcode.js" crossorigin="anonymous"></script>
    
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
	</head>
	<body>
	  <div id="catch-table"></div>
    <script>
      function jsonToTable(obj) {
        var colnames =  Array.from(Object.entries(obj.data.cols), ([key, value]) => value.label);
        var rows = obj.data.rows
        var rows = Object.keys(rows).map( function (key) {
          var row = rows[key].c;
          row = Array.from(Object.entries(row), ([key, value]) => value.v);
          const target = {}; 
          target.id = key;
          for (var o = 0, l = colnames.length; o < l; o++) {
            target[colnames[o]] = row[o];
          } 
          target.Dato = eval("new " + target.Dato).toLocaleDateString();
          target.Navn = target.Navn.replace(/(^\w{1})|(\s+\w{1})/g, letter => letter.toUpperCase());
          target.Misc = '<i class="fa-solid fa-camera" style="color: #74C0FC;"></i>'
          return target; 
        });
        return rows;
      }            
              
      //custom formatter definition
      var miscCol = function(cell, formatterParams, onRendered){ //plain text value
          return "<i class='fa fa-print'></i>";
      };              
              
    	var table = new Tabulator("#catch-table", {
    		height:600, // set height of table to enable virtual DOM
    		layout:"fitColumns", //fit columns to width of table (optional),
    		responsiveLayout:"hide",
    		columns:[ //Define Table Columns
    		  	{title:"Dato", field:"Dato", sorter:"date",  hozAlign:"center", sorterParams:{format:"dd/MM/yyyy", alignEmptyValues:"top",}},
    		  	{title:"Fiskevand", field:"Fiskevand", sorter:"string", hozAlign:"center"},
    		  	{title:"Strækning", field:"Strækning/sted", sorter:"string", hozAlign:"center"},
    		  	{title:"Art", field:"Art", sorter:"string", hozAlign:"center"},
    		  	{title:"Længde", field:"Længde", sorter:"number", hozAlign:"center"},
    		  	{title:"Vægt", field:"Vægt", sorter:"string", hozAlign:"center"},
    		  	{title:"Agn", field:"Agn", sorter:"string", hozAlign:"center"},
    			  {title:"Navn", field:"Navn", sorter:"string", hozAlign:"left"},
    			  {title:"Bemærkning", field:"Bemærkning", sorter:null, hozAlign:"left"},
    			  {title:"Misc", field:"Misc", sorter:"string", hozAlign:"center", formatter:"html"},
    		],
    	});

      $.getJSON("https://fangstjournalen.dtu.dk/fangst.nsf/service.xsp?open&club=37E6FB0707BAE0A1C1257F3A003FF013&type=1", function(data){
              //str = JSON.stringify(data, null, 4); // (Optional) beautiful indented output.
              //console.log(str); // Logs output to dev tools console.
              tableData = jsonToTable(data)
              //str = JSON.stringify(tableData, null, 4); // (Optional) beautiful indented output.
              //console.log(str); // Logs output to dev tools console.
              table.setData(tableData);
          }).fail(function(){
              console.log("An error has occurred.");
          });
          
	  //var tmp = Date.parse('Date(2024,2,9)')
	  //tmp = new Date(2024,2,9)
	  //tmp = new {eval('Date(2024,2,9)')};
	  str = "Date(2024,2,9)"
	  tmp = eval("new " + str)
	  //tmp = tmp.toLocaleDateString('en-us', { year:"numeric", month:"short", day:"numeric"}); 
// "Friday, Jul 2, 2021";
    //str = JSON.stringify(tmp, null, 4); // (Optional) beautiful indented output.
    //console.log(tmp) // Logs output to dev tools console.
    </script> 	  
	 

</script>	  
	</body>
</html>