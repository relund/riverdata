---
title: "Fangst analyse af MV-LFs strækninger"
author: "Lars Relund Nielsen"
date: "`r Sys.Date()`"
output: 
  html_document:
    self_contained: true
    theme: united
    highlight: tango
    df_print: paged
    # code_folding: show
    # toc: true
    # toc_float: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(knitr)
library(tidyverse)
library(lubridate)
library(shiny)
library(DT)
# library(zoo) 
library(jsonlite)

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning=FALSE, message=FALSE, 
  include = TRUE, echo = FALSE, 
  cache = FALSE, autodep = TRUE,
  out.width = "99%", fig.width = 8, fig.align = "center", fig.asp = 0.62
)

```


## Karup Å

```{r}
library(rvest)
url <- "https://fangstjournalen.dtu.dk/fangst.nsf/extEntry.xsp?open&club=37E6FB0707BAE0A1C1257F3A003FF013"
page <- read_html(url)
tmp <- page %>%
  html_elements(xpath = '//*[@id="view:_id1:inputClubLocation"]') %>% 
  html_elements("option") %>% 
  html_text() 
tmp <- unique(tmp[tmp != ""])
river <- str_extract(tmp, "^.*\\((.*)\\)$", group = 1)
river[is.na(river)] <- tmp[is.na(river)]
place <- str_extract(tmp, "^(.*)\\((.*)\\)$", group = 1) %>% 
  str_trim()
place[is.na(place)] <- tmp[is.na(place)]
datPlaces <- tibble(River = river, Place = place)
```



```{r}
# source("functions.R")
prefix <- "data/data_mv-lf"
yr <- year(now()
dat <- NULL
for (y in years) {
  fn <- paste0(prefix, "_catch_all_", y, ".csv")
  dat <- 
    bind_rows(dat, read_csv(fn, col_types = "Tfd"))
}




url <- "https://fangstjournalen.dtu.dk/fangst.nsf/xsp/app/v3/catches/club/37E6FB0707BAE0A1C1257F3A003FF013/1/"

datCatch <- readCatchDTU(url) 
datCatch <- datCatch %>% 
  mutate(Year = year(Date))

dat <- datCatch %>% 
  count(River, Place, Year) 
dat <- full_join(dat, datPlaces)

dat %>% pivot_wider(names_from = Year, values_from = n)


```

